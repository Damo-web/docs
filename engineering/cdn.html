<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CDN | Damo</title>
    <meta name="description" content="达摩院文档平台">
    <link rel="shortcut icon" type="image/x-icon" href="/docs/favicon.ico">
  <link rel="manifest" href="/docs/manifest.json">
    
    <link rel="preload" href="/docs/assets/css/0.styles.ba6021e1.css" as="style"><link rel="preload" href="/docs/assets/js/app.bb5e32e8.js" as="script"><link rel="preload" href="/docs/assets/js/2.3b5bc873.js" as="script"><link rel="preload" href="/docs/assets/js/7.b57c8ee5.js" as="script"><link rel="preload" href="/docs/assets/js/22.e56f6488.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.e79ac61c.js"><link rel="prefetch" href="/docs/assets/js/11.231bcbc2.js"><link rel="prefetch" href="/docs/assets/js/12.c158b58e.js"><link rel="prefetch" href="/docs/assets/js/13.4d87ce46.js"><link rel="prefetch" href="/docs/assets/js/14.7c9ff823.js"><link rel="prefetch" href="/docs/assets/js/15.6db4bdac.js"><link rel="prefetch" href="/docs/assets/js/16.a5e840e7.js"><link rel="prefetch" href="/docs/assets/js/17.ec94b3d5.js"><link rel="prefetch" href="/docs/assets/js/18.fae32894.js"><link rel="prefetch" href="/docs/assets/js/19.0616547f.js"><link rel="prefetch" href="/docs/assets/js/20.0911ce1c.js"><link rel="prefetch" href="/docs/assets/js/21.2f377134.js"><link rel="prefetch" href="/docs/assets/js/23.a4767746.js"><link rel="prefetch" href="/docs/assets/js/24.00d42de4.js"><link rel="prefetch" href="/docs/assets/js/25.e565c20f.js"><link rel="prefetch" href="/docs/assets/js/26.ba96a6e3.js"><link rel="prefetch" href="/docs/assets/js/27.11a11261.js"><link rel="prefetch" href="/docs/assets/js/28.b49aaaba.js"><link rel="prefetch" href="/docs/assets/js/29.2e6a7a2d.js"><link rel="prefetch" href="/docs/assets/js/3.b55da558.js"><link rel="prefetch" href="/docs/assets/js/30.8ea5fdcf.js"><link rel="prefetch" href="/docs/assets/js/31.bb57c422.js"><link rel="prefetch" href="/docs/assets/js/32.bc41411c.js"><link rel="prefetch" href="/docs/assets/js/33.5ad4e0f7.js"><link rel="prefetch" href="/docs/assets/js/34.e046d4c9.js"><link rel="prefetch" href="/docs/assets/js/35.9fe3872e.js"><link rel="prefetch" href="/docs/assets/js/36.ba8de101.js"><link rel="prefetch" href="/docs/assets/js/37.854a398e.js"><link rel="prefetch" href="/docs/assets/js/38.bfd940cf.js"><link rel="prefetch" href="/docs/assets/js/39.599fa4d5.js"><link rel="prefetch" href="/docs/assets/js/4.ca28c6e7.js"><link rel="prefetch" href="/docs/assets/js/40.f4157755.js"><link rel="prefetch" href="/docs/assets/js/41.d78fffc0.js"><link rel="prefetch" href="/docs/assets/js/5.d10ece1f.js"><link rel="prefetch" href="/docs/assets/js/6.b76f823f.js"><link rel="prefetch" href="/docs/assets/js/8.bc6cdd57.js"><link rel="prefetch" href="/docs/assets/js/9.454003ec.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.ba6021e1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">Damo</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/platform/" class="nav-link">跨端</a></div><div class="nav-item"><a href="/docs/server/" class="nav-link">服务端</a></div><div class="nav-item"><a href="/docs/framework/" class="nav-link">框架</a></div><div class="nav-item"><a href="/docs/engineering/" class="nav-link router-link-active">工程化</a></div><div class="nav-item"><a href="/docs/render/" class="nav-link">渲染</a></div><div class="nav-item"><a href="/docs/media/" class="nav-link">互动媒体</a></div> <a href="https://github.com/Damo-web/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/platform/" class="nav-link">跨端</a></div><div class="nav-item"><a href="/docs/server/" class="nav-link">服务端</a></div><div class="nav-item"><a href="/docs/framework/" class="nav-link">框架</a></div><div class="nav-item"><a href="/docs/engineering/" class="nav-link router-link-active">工程化</a></div><div class="nav-item"><a href="/docs/render/" class="nav-link">渲染</a></div><div class="nav-item"><a href="/docs/media/" class="nav-link">互动媒体</a></div> <a href="https://github.com/Damo-web/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>文章列表</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/engineering/" class="sidebar-link">Webpack Optimization</a></li><li><a href="/docs/engineering/eslint.html" class="sidebar-link">ESLint</a></li><li><a href="/docs/engineering/stylelint.html" class="sidebar-link">StyleLint</a></li><li><a href="/docs/engineering/easymock.html" class="sidebar-link">EasyMock</a></li><li><a href="/docs/engineering/staticsite.html" class="sidebar-link">Static Site Generator</a></li><li><a href="/docs/engineering/ci.html" class="sidebar-link">CI / CD</a></li><li><a href="/docs/engineering/jenkins.html" class="sidebar-link">Jenkins CI</a></li><li><a href="/docs/engineering/drone.html" class="sidebar-link">Drone CI</a></li><li><a href="/docs/engineering/circle.html" class="sidebar-link">Circle CI</a></li><li><a href="/docs/engineering/travis.html" class="sidebar-link">Travis CI</a></li><li><a href="/docs/engineering/harbor.html" class="sidebar-link">Harbor</a></li><li><a href="/docs/engineering/build.html" class="sidebar-link">Build Optimization</a></li><li><a href="/docs/engineering/nginx.html" class="sidebar-link">Nginx</a></li><li><a href="/docs/engineering/domain.html" class="sidebar-link">Domain</a></li><li><a href="/docs/engineering/cdn.html" class="active sidebar-link">CDN</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/engineering/cdn.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/docs/engineering/cdn.html#cdn-原理" class="sidebar-link">CDN 原理</a></li><li class="sidebar-sub-header"><a href="/docs/engineering/cdn.html#cdn-加速" class="sidebar-link">CDN 加速</a></li><li class="sidebar-sub-header"><a href="/docs/engineering/cdn.html#cdn-命中" class="sidebar-link">CDN 命中</a></li><li class="sidebar-sub-header"><a href="/docs/engineering/cdn.html#cdn-回源" class="sidebar-link">CDN 回源</a></li><li class="sidebar-sub-header"><a href="/docs/engineering/cdn.html#cdn-缓存" class="sidebar-link">CDN 缓存</a></li><li class="sidebar-sub-header"><a href="/docs/engineering/cdn.html#cdn-更新" class="sidebar-link">CDN 更新</a></li><li class="sidebar-sub-header"><a href="/docs/engineering/cdn.html#参考链接" class="sidebar-link">参考链接</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="cdn"><a href="#cdn" aria-hidden="true" class="header-anchor">#</a> CDN</h1> <blockquote><p>内容分发网络（ Content Delivery Network，可简称为 CDN ）是指一种透过互联网互相连接的计算机网络系统，利用最靠近每位用户的服务器，更快、更可靠地将音乐、图片、影片、应用程序及其他文件发送给用户，来提供高性能、可扩展性及低成本的网络内容传递给用户。注：本篇目主要是面向前端的指南。</p></blockquote> <h2 id="前言"><a href="#前言" aria-hidden="true" class="header-anchor">#</a> 前言</h2> <p>互联网早期时代，用户量少，带宽低，富媒体资源体量有限，服务器的压力较低。随着互联网的发展，用户量爆炸增长，富媒体资源发展迅速，导致源内容服务器压力越来越大，主干网络拥堵越来越常见。</p> <p>为解决网络拥堵这一问题，CDN应运而生，其核心理念即将内容缓存在用户周边。直白点说，当用户访问网站时，通过 CDN 负载均衡系统，将此次访问指向至最近的缓存服务器，由该缓存服务器提供网络服务。</p> <p>CDN 缓存服务器一般称作 CDN 节点，其实跟电商网购平台的物流仓有点类似，为了产品更快到达用户手中，减少用户等待时长，网购订单下达后，会通过电商的物流系统分配最近的发货仓和配送站。同样，CDN 服务商会提供各区域及各运营商 CDN 节点，当用户访问网站时，会根据当前各节点负载情况及访问者的位置信息，分配最合适的节点来分发源内容网站的资源，提高用户访问该网站资源的速度。</p> <h2 id="cdn-原理"><a href="#cdn-原理" aria-hidden="true" class="header-anchor">#</a> CDN 原理</h2> <p>CDN 的基本流程图如下：</p> <p><img src="/docs/assets/img/cdn_flow.60262517.svg" alt=""></p> <p>举个例子，网站 <code>www.snowball.site</code> 中静态资源的预设 CDN 域名为 <code>cdn-static.snowball.site</code>，CDN 服务商提供的 CNAME 地址为 <code>ouyt4c4z5.bkt.clouddn.com</code> ，静态资源的 CDN 域名指向对应的 CNAME 地址这一绑定操作已完成。</p> <p>CDN 整体分为两大步骤，即 DNS 解析 和 CDN 服务，具体步骤如下：</p> <ol><li><p>浏览器访问 <code>cdn-static.snowball.site</code> 下的资源，倘若存在缓存，则直接使用缓存，否则对该域名进行 DNS 解析（ 此处细节可参阅 <a href="/docs/engineering/domain.html#解析流程">域名解析流程</a> ），通过网站域名服务器查询得知该域名为 CNAME 记录，指向 <code>ouyt4c4z5.bkt.clouddn.com</code> 。</p></li> <li><p>对域名 <code>ouyt4c4z5.bkt.clouddn.com</code> 进行 DNS 查询，由 CDN 服务商的全局负载均衡系统（ Global Server Load Balancing，可简称 GSLB ）给出该域名 A 或 AAAA 记录下 IP 地址 66.42.115.162，即离用户最近的 CDN 边缘节点，至此 DNS 解析流程完成。</p></li> <li><p>对 CDN 边缘节点 66.42.115.162 发起请求，倘若边缘节点存在该静态资源缓存，则直接返回缓存结果，否则向 CDN 中心节点发起请求。</p></li> <li><p>CDN 中心节点在其缓存中查询是否存在该静态资源，若存在则返回缓存结果至 CDN 边缘节点，否则回源拉取资源。</p></li> <li><p>CDN 中心节点依据设置的回源地址（ 可以是域名或 IP 地址，比如 <code>www.snowball.site</code> ），将请求转发至源站，由源站提供静态资源服务，至此 CDN 服务流程完成。</p></li></ol> <h2 id="cdn-加速"><a href="#cdn-加速" aria-hidden="true" class="header-anchor">#</a> CDN 加速</h2> <p>CDN 加速按业务主要分为五种类型：</p> <ul><li><p>小型静态资源</p> <p>以图片、网页样式文件、网页脚本文件等小文件为主的网站及应用</p></li> <li><p>大型静态资源</p> <p>以安装包、系统升级包、应用升级包等大文件为主的网站及应用</p></li> <li><p>音视频点播</p> <p>以音乐、语音、视频等点播资源为主的网站及应用</p></li> <li><p>直播流媒体</p> <p>以视频直播、语音直播等直播资源为主的网站及应用</p></li> <li><p>全站加速</p> <p>存在大量动静态内容，并且以动态资源居多的网站或应用</p></li></ul> <p>目前，网站通常采用动静分离的方案，即只针对网页样式文件、脚本文件及图片等静态资源进行 CDN 加速，常与静态资源存储相结合；倘若动态资源居多，也可采用动静结合的方案，即对整站动静态资源进行 CDN 加速，需要注意，动态资源加速需要回源，但针对客户端至源站的通道进行了链路优化。</p> <h2 id="cdn-命中"><a href="#cdn-命中" aria-hidden="true" class="header-anchor">#</a> CDN 命中</h2> <p>当网站静态资源采用 CDN 时，CDN 命中率是常见指标，用来衡量网站加速效果。</p> <p>顾名思义，CDN 命中率是指用户访问资源时命中缓存的概率。通常，CDN 命中率越高，表明网站加速效果越好。</p> <p>网站静态资源通常用 Hit 及 Miss 来表明是否命中 CDN 缓存：Hit 表示命中 CDN 缓存，Miss 表示未命中 CDN 缓存。CDN 服务商会在 HTTP 响应头信息中采用自定义 HTTP 头信息方式来表明资源是否命中 CDN 缓存，不同服务商用于描述 CDN 缓存命中情况的字段往往不同，通常会采用 x-cache 或 x-cache-lookup 字段来描述。</p> <p>以国内阿里云、腾讯云、七牛云、网宿、白山云为例，HTTP 响应头信息如下：</p> <ul><li><p>阿里云</p> <div class="language-bash extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-bash"><code><span class="token comment"># 请求资源</span>
<span class="token function">curl</span> -I https://img.alicdn.com/tfs/TB1Ly5oS3HqK1RjSZFPXXcwapXa-238-54.png

<span class="token comment"># 响应头信息</span>
HTTP/2 <span class="token number">200</span> 
server: Tengine
content-type: image/png
content-length: <span class="token number">1100</span>
date: Thu, <span class="token number">23</span> May <span class="token number">2019</span> 05:56:00 GMT
last-modified: Fri, <span class="token number">26</span> Apr <span class="token number">2019</span> 08:36:57 GMT
expires: Fri, <span class="token number">22</span> May <span class="token number">2020</span> 05:56:00 GMT
cache-control: max-age<span class="token operator">=</span><span class="token number">31536000</span>
ali-swift-global-savetime: <span class="token number">1558590960</span>
via: cache15.l2hk71<span class="token punctuation">[</span><span class="token number">0,200</span>-0,H<span class="token punctuation">]</span>, cache16.l2hk71<span class="token punctuation">[</span><span class="token number">0,0</span><span class="token punctuation">]</span>, cache5.jp3<span class="token punctuation">[</span><span class="token number">0,200</span>-0,H<span class="token punctuation">]</span>, cache12.jp3<span class="token punctuation">[</span><span class="token number">0,0</span><span class="token punctuation">]</span>
access-control-allow-origin: *
age: <span class="token number">7704720</span>
x-cache: HIT TCP_MEM_HIT dirn:9:280914441
x-swift-savetime: Thu, <span class="token number">23</span> May <span class="token number">2019</span> 07:23:54 GMT
x-swift-cachetime: <span class="token number">31530726</span>
timing-allow-origin: *
eagleid: 2ff604a015662956808786212e
</code></pre></div><p>阿里云 CDN 缓存是否命中通过 x-cache 字段来描述： HIT TCP_MEM_HIT 表示命中 CDN 缓存，MISS TCP_MISS 表示未命中 CDN 缓存。</p> <p>有关缓存时间的字段如下：</p> <ul><li><p>x-swift-savetime：资源在 CDN 上缓存的时间。</p></li> <li><p>x-swift-cachetime：CDN 默认缓存时间，以秒为单位。</p></li> <li><p>age：资源在 CDN 上已缓存的时间，以秒为单位。</p></li></ul></li> <li><p>腾讯云</p> <div class="language-bash extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-bash"><code><span class="token comment"># 请求资源</span>
<span class="token function">curl</span> -I https://imgcache.qq.com/open_proj/proj_qcloud_v2/gateway/portal/css/img/QRcode.png

<span class="token comment"># 响应头信息</span>
HTTP/2 <span class="token number">200</span> 
server: NWSs
date: Sat, <span class="token number">24</span> Aug <span class="token number">2019</span> <span class="token number">15</span>:53:18 GMT
content-type: image/png
content-length: <span class="token number">13232</span>
cache-control: max-age<span class="token operator">=</span><span class="token number">3600</span>
expires: Sat, <span class="token number">24</span> Aug <span class="token number">2019</span> <span class="token number">16</span>:53:17 GMT
last-modified: Wed, 07 Aug <span class="token number">2019</span> <span class="token number">11</span>:47:48 GMT
x-nws-log-uuid: ad280c57-bb5a-42fd-ac3f-45a7867200a8
server_ip: <span class="token number">203.205</span>.138.79
vary: Accept
x-cache-lookup: Hit From Disktank3
x-datasrc: <span class="token number">2</span>
x-reqgue: <span class="token number">0</span>
</code></pre></div><p>腾讯云 CDN 缓存是否命中通过 x-cache-lookup 字段来描述： Hit From MemCache 表示命中 CDN 节点内存，Hit From Disktank 表示命中 CDN 节点硬盘，Hit From Upstream 表示未命中 CDN 缓存。</p></li> <li><p>七牛云</p> <div class="language-bash extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-bash"><code><span class="token comment"># 请求资源</span>
<span class="token function">curl</span> -I https://mars-assets.qnssl.com/FspZJF8xgIz24cG8xWeq8Sq3yIKB

<span class="token comment"># 响应头信息</span>
HTTP/1.1 <span class="token number">200</span> OK
Server: Tengine
Content-Type: image/jpeg
Content-Length: <span class="token number">619829</span>
Connection: keep-alive
Date: Fri, <span class="token number">23</span> Aug <span class="token number">2019</span> <span class="token number">23</span>:49:08 GMT
Cache-Control: public, max-age<span class="token operator">=</span><span class="token number">31536000</span>
Etag: <span class="token string">&quot;FspZJF8xgIz24cG8xWeq8Sq3yIKB&quot;</span>
X-M-Log: QNM:jjh1877<span class="token punctuation">;</span>QNM3:15/304
X-M-Reqid: HnIAAKOV40Yssr0V
X-Qnm-Cache: Hit
Access-Control-Allow-Origin: *
Access-Control-Expose-Headers: X-Log, X-Reqid
Access-Control-Max-Age: <span class="token number">2592000</span>
X-Log: X-Log
X-Qiniu-Zone: <span class="token number">0</span>
X-Reqid: c68AAACfQWhLZ7QV
X-Svr: IO
Accept-Ranges: bytes
Content-Disposition: inline<span class="token punctuation">;</span> <span class="token assign-left variable">filename</span><span class="token operator">=</span><span class="token string">&quot;FspZJF8xgIz24cG8xWeq8Sq3yIKB&quot;</span><span class="token punctuation">;</span> filename*<span class="token operator">=</span>utf-8<span class="token string">' '</span>FspZJF8xgIz24cG8xWeq8Sq3yIKB
Content-Transfer-Encoding: binary
Last-Modified: Wed, 08 Aug <span class="token number">2018</span> 06:05:56 GMT
Ali-Swift-Global-Savetime: <span class="token number">1561275461</span>
Via: cache6.l2cn1820<span class="token punctuation">[</span><span class="token number">0,200</span>-0,H<span class="token punctuation">]</span>, cache24.l2cn1820<span class="token punctuation">[</span><span class="token number">1,0</span><span class="token punctuation">]</span>, cache5.cn348<span class="token punctuation">[</span><span class="token number">0,200</span>-0,H<span class="token punctuation">]</span>, cache4.cn348<span class="token punctuation">[</span><span class="token number">0,0</span><span class="token punctuation">]</span>
Age: <span class="token number">202747</span>
X-Cache: HIT TCP_MEM_HIT dirn:3:101958844
X-Swift-SaveTime: Sat, <span class="token number">24</span> Aug <span class="token number">2019</span> <span class="token number">19</span>:26:57 GMT
X-Swift-CacheTime: <span class="token number">2592000</span>
Timing-Allow-Origin: *
EagleId: 75198b9015668068952507972e
</code></pre></div><p>七牛云 CDN 缓存是否命中通过 X-Qnm-Cache 字段来描述： HIT 表示命中 CDN 缓存，MISS 表示未命中 CDN 缓存。</p></li> <li><p>网宿</p> <div class="language-bash extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-bash"><code><span class="token comment"># 请求资源</span>
<span class="token function">curl</span> -I https://www.wangsu.com/Upload/image/20190505/20190505162956_0140.jpg

<span class="token comment"># 响应头信息</span>
HTTP/1.1 <span class="token number">200</span> OK
Date: Mon, <span class="token number">26</span> Aug <span class="token number">2019</span> 09:34:00 GMT
Content-Type: image/png
Content-Length: <span class="token number">1446</span>
Connection: keep-alive
Server: waf/2.15.3-8.el6
Last-Modified: Thu, <span class="token number">25</span> Oct <span class="token number">2018</span> 03:10:46 GMT
ETag: <span class="token string">&quot;6000539-5a6-57904f2ecf980&quot;</span>
Accept-Ranges: bytes
Age: <span class="token number">1</span>
X-Via: <span class="token number">1.1</span> PSbjwjBGP2pt139:2 <span class="token punctuation">(</span>Cdn Cache Server V2.0<span class="token punctuation">)</span>, <span class="token number">1.1</span> adianxin68:13 <span class="token punctuation">(</span>Cdn Cache Server V2.0<span class="token punctuation">)</span>
Cache-Control: max-age<span class="token operator">=</span><span class="token number">604800</span>
</code></pre></div><p>网宿 CDN 缓存是否命中通过 X-Via 字段来描述：Cdn Cache Server 字段表明采用了 CDN 服务。</p></li> <li><p>白山云</p> <div class="language-bash extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-bash"><code><span class="token comment"># 请求资源</span>
<span class="token function">curl</span> -I https://pic4.zhimg.com/v2-b43a4701f84d12e9cbd1c43a7b276be6_l.jpg

<span class="token comment"># 响应头信息</span>
HTTP/2 <span class="token number">200</span> 
date: Mon, <span class="token number">26</span> Aug <span class="token number">2019</span> 09:17:47 GMT
content-type: image/jpeg
content-length: <span class="token number">5998</span>
server: AliyunOSS
x-oss-request-id: 5B3F08BF776D387FCB8617B5
etag: <span class="token string">&quot;B43A4701F84D12E9CBD1C43A7B276BE6&quot;</span>
last-modified: Mon, <span class="token number">25</span> Dec <span class="token number">2017</span> 04:35:25 GMT
x-oss-object-type: Normal
x-oss-storage-class: Standard
x-oss-meta-format: jpeg
x-oss-meta-height: <span class="token number">896</span>
x-oss-meta-width: <span class="token number">896</span>
x-oss-hash-crc64ecma: <span class="token number">11490056169299473555</span>
x-ser: BC34_dx-lt-yd-fujian-xiamen-8-cache-3, BC240_dx-zhejiang-jinhua-2-cache-8
x-cache: HIT from BC240_dx-zhejiang-jinhua-2-cache-8<span class="token punctuation">(</span>baishan<span class="token punctuation">)</span>
cache-control: public, max-age<span class="token operator">=</span><span class="token number">31536000</span>
access-control-allow-origin: *
access-control-max-age: <span class="token number">2592000</span>
x-cdn-provider: BS
</code></pre></div><p>白山云 CDN 缓存是否命中通过 x-cache 字段来描述： HIT 表示命中 CDN 缓存，MISS 表示未命中 CDN 缓存。</p></li></ul> <p>以国外 Akamai、AWS CloudFront、Cloudflare、Fastly 为例，HTTP 响应头信息如下：</p> <ul><li><p>Akamai</p> <div class="language-bash extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre class="language-bash"><code><span class="token comment"># 请求资源</span>
<span class="token function">curl</span> -I -H <span class="token string">&quot;Pragma: akamai-x-cache-on,akamai-x-get-cache-key&quot;</span> https://a0.muscache.com/im/pictures/1e338975-3b45-4681-a493-934c1b26baf6.jpg?aki_policy<span class="token operator">=</span>large

<span class="token comment"># 响应头信息</span>
HTTP/2 <span class="token number">200</span> 
etag: <span class="token string">&quot;672916e11cf4620bc09d3f5f1998afe000a5b3d9&quot;</span>
last-modified: Fri, <span class="token number">26</span> Jul <span class="token number">2019</span> <span class="token number">13</span>:32:52 GMT
server: Akamai Image Manager
x-akamai-ssl-client-sid: <span class="token assign-left variable">SCHxwOaBMKXMexiInrJ7ZQ</span><span class="token operator">==</span>
x-edgeconnect-midmile-rtt: <span class="token number">63</span>
x-edgeconnect-origin-mex-latency: <span class="token number">202</span>
content-length: <span class="token number">18921</span>
content-type: image/jpeg
x-serial: <span class="token number">1354</span>
x-check-cacheable: YES
x-akamai-pragma-client-ip: <span class="token number">165.254</span>.156.76, <span class="token number">149.28</span>.71.143
cache-control: private, no-transform, max-age<span class="token operator">=</span><span class="token number">1683156</span>
expires: Sat, <span class="token number">14</span> Sep <span class="token number">2019</span> 04:25:22 GMT
date: Sun, <span class="token number">25</span> Aug <span class="token number">2019</span> <span class="token number">16</span>:52:46 GMT
x-cache: TCP_HIT from a165-254-156-76.deploy.akamaitechnologies.com <span class="token punctuation">(</span>AkamaiGHost/9.8.0-26986073<span class="token punctuation">)</span> <span class="token punctuation">(</span>-<span class="token punctuation">)</span>
x-cache-key: L1/L/16382/485063/30d/origin-images.airbnb.com/im/pictures/1e338975-3b45-4681-a493-934c1b26baf6.jpg <span class="token assign-left variable">cid</span><span class="token operator">=</span>___IM_FILE_NAME<span class="token operator">=</span>large.1.5000.generic<span class="token operator">&amp;</span><span class="token assign-left variable">IM_API_TOKEN</span><span class="token operator">=</span>airbnb-10168275<span class="token operator">&amp;</span><span class="token assign-left variable">IM_COMB_ON</span><span class="token operator">=</span>true
x-cache-key-extended-internal-use-only: L1/L/16382/485063/30d/origin-images.airbnb.com/im/pictures/1e338975-3b45-4681-a493-934c1b26baf6.jpg <span class="token assign-left variable">vcd</span><span class="token operator">=</span><span class="token number">12141</span> <span class="token assign-left variable">cid</span><span class="token operator">=</span>___IM_FILE_NAME<span class="token operator">=</span>large.1.5000.generic<span class="token operator">&amp;</span><span class="token assign-left variable">IM_API_TOKEN</span><span class="token operator">=</span>airbnb-10168275<span class="token operator">&amp;</span><span class="token assign-left variable">IM_COMB_ON</span><span class="token operator">=</span>true
strict-transport-security: max-age<span class="token operator">=</span><span class="token number">10886400</span><span class="token punctuation">;</span> includeSubDomains
access-control-allow-methods: GET
access-control-allow-origin: *
timing-allow-origin: *
</code></pre></div><p>Akamai CDN 缓存是否命中通过 x-cache 字段来描述，具体缓存响应状态如下：</p> <ul><li><p>TCP_HIT：</p> <p>资源在缓存中是有效的，并且资源只缓存在硬盘中，直接从缓存中返回资源</p></li> <li><p>TCP_MISS：</p> <p>资源不在缓存中，则从源站获取资源</p></li> <li><p>TCP_REFRESH_HIT：</p> <p>资源在缓存中显示是过期的，通过 If-Modified-Since 请求源站得知资源依然是有效的</p></li> <li><p>TCP_REFRESH_MISS：</p> <p>资源在缓存中显示是过期的，通过 If-Modified-Since 请求源站得知资源是过期的，则获取并返回新资源</p></li> <li><p>TCP_REFRESH_FAIL_HIT：</p> <p>资源在缓存中显示是过期的，通过 If-Modified-Since 请求源站，但无法访问源站，依旧返回该资源</p></li> <li><p>TCP_IMS_HIT：</p> <p>发现客户端之前通过 IF-Modified-Since 请求过资源，并且资源在缓存中是有效的，无需请求源站直接返回资源</p></li> <li><p>TCP_NEGATIVE_HIT：</p> <p>资源之前响应失败，依旧会缓存这次失败响应，重复访问时，会命中之前的资源响应失败的缓存</p></li> <li><p>TCP_MEM_HIT：</p> <p>在内存中发现缓存资源，直接返回至客户端</p></li> <li><p>TCP_DENIED：</p> <p>无论出于何种原因拒绝客户端访问</p></li> <li><p>TCP_COOKIE_DENY：</p> <p>拒绝客户端通过 cookie 验证方式访问</p></li></ul> <p>除此之外还有 x-check-cacheable 这个字段，用于描述是否该资源在 Akamai 配置中设置为可缓存，Yes 表明已设置为可缓存，No 表明未进行设置。</p></li> <li><p>AWS CloudFront</p> <div class="language-bash extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-bash"><code><span class="token comment"># 请求资源</span>
<span class="token function">curl</span> -I https://d1.awsstatic.com/logos/customers/Netflix-logo.0eba3826789115172a6870cff5c6c35f8d478d65.png

<span class="token comment"># 响应头信息</span>
HTTP/2 <span class="token number">200</span> 
content-type: image/png
content-length: <span class="token number">3847</span>
date: Sun, <span class="token number">25</span> Aug <span class="token number">2019</span> <span class="token number">15</span>:42:07 GMT
x-amz-replication-status: COMPLETED
last-modified: Thu, <span class="token number">13</span> Dec <span class="token number">2018</span> <span class="token number">21</span>:50:25 GMT
etag: <span class="token string">&quot;d74db421bcfcd1ece26e9990199960c7&quot;</span>
x-amz-meta-version: <span class="token number">2018</span>-12-13T21:48:21.932Z
cache-control: max-age<span class="token operator">=</span><span class="token number">31536000</span>
x-amz-version-id: e23.pgOuANwy9ERXZAB_roB7W3i4LCTt
accept-ranges: bytes
server: AmazonS3
age: <span class="token number">12</span>
x-cache: Hit from cloudfront
via: <span class="token number">1.1</span> 10e0af8ebbb9eea9a777605bac3912db.cloudfront.net <span class="token punctuation">(</span>CloudFront<span class="token punctuation">)</span>
x-amz-cf-pop: NRT12-C2
x-amz-cf-id: fFy_bspNOdTBH7aOSBxxrl7C28-Yw7dcW9I8joUH7KhVcfWOtYEgRA<span class="token operator">==</span>
</code></pre></div><p>AWS CloudFront 缓存是否命中通过 x-cache 字段来描述： Hit from cloudfront 表示命中 CDN 缓存，Miss from cloudfront 表示未命中 CDN 缓存。</p></li> <li><p>Cloudflare</p> <div class="language-bash extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre class="language-bash"><code><span class="token comment"># 请求资源</span>
<span class="token function">curl</span> -I https://cdn-images-1.medium.com/fit/c/304/312/1*5gr12p-iLOr9ySir83Gzbg.png

<span class="token comment"># 响应头信息</span>
HTTP/2 <span class="token number">200</span> 
date: Sun, <span class="token number">25</span> Aug <span class="token number">2019</span> <span class="token number">15</span>:40:11 GMT
content-type: image/png
content-length: <span class="token number">128430</span>
set-cookie: <span class="token assign-left variable">__cfduid</span><span class="token operator">=</span>d99a08cf01203ce4cd7220812e5636dbb1566747611<span class="token punctuation">;</span> <span class="token assign-left variable">expires</span><span class="token operator">=</span>Mon, <span class="token number">24</span>-Aug-20 <span class="token number">15</span>:40:11 GMT<span class="token punctuation">;</span> <span class="token assign-left variable">path</span><span class="token operator">=</span>/<span class="token punctuation">;</span> <span class="token assign-left variable">domain</span><span class="token operator">=</span>.medium.com<span class="token punctuation">;</span> HttpOnly
access-control-allow-origin: *
cache-control: public, max-age<span class="token operator">=</span><span class="token number">2592000</span>
etag: <span class="token string">&quot;16.3&quot;</span>
expires: Tue, <span class="token number">24</span> Sep <span class="token number">2019</span> <span class="token number">15</span>:40:11 GMT
pragma: public
x-obvious-info: <span class="token number">16.3</span>, <span class="token number">3197</span>-fb89d63
x-powered-by: Geomyidae artificij
strict-transport-security: max-age<span class="token operator">=</span><span class="token number">15552000</span><span class="token punctuation">;</span> includeSubDomains<span class="token punctuation">;</span> preload
cf-cache-status: HIT
age: <span class="token number">977007</span>
accept-ranges: bytes
x-content-type-options: nosniff
expect-ct: max-age<span class="token operator">=</span><span class="token number">604800</span>, report-uri<span class="token operator">=</span><span class="token string">&quot;https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct&quot;</span>
server: cloudflare
cf-ray: 50bea9b8cea8d63d-NRT
</code></pre></div><p>Cloudflare 缓存是否命中通过 cf-cache-status 字段来描述，具体缓存响应状态如下：</p> <ul><li><p>HIT</p> <p>资源在缓存中，直接从缓存中返回</p></li> <li><p>MISS</p> <p>资源不在缓存中，从源站获取并返回</p></li> <li><p>EXPIRED</p> <p>资源在缓存中，但已经过期，从源站获取并返回</p></li> <li><p>STALE</p> <p>资源在缓存中，但已经过期，向源站请求，但其未响应，依旧返回已过期资源</p></li> <li><p>BYPASS</p> <p>源站设置 CDN 始终绕过缓存，请求头 cache-control 为不缓存</p></li> <li><p>REVALIDATED</p> <p>缓存中资源是过期的，但已被 If-Modified-Since 或 If-None-Match 请求验证</p></li> <li><p>UPDATING</p> <p>资源正在缓存中，而且现有缓存中资源是过期的。通常只有大文件或高热度资源更新时触发此状态。</p></li></ul></li> <li><p>Fastly</p> <div class="language-bash extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-bash"><code><span class="token comment"># 请求资源</span>
<span class="token function">curl</span> -I https://cdn.dribbble.com/assets/icon-shot-x-light-2x-a4fcd61bdb114023583740bd9f5a46734e243e5be2bff1baa3e1cc33e7877fcd.png

<span class="token comment"># 响应头信息</span>
HTTP/2 <span class="token number">200</span> 
content-type: image/png
last-modified: Wed, <span class="token number">27</span> Feb <span class="token number">2019</span> 03:35:29 GMT
expires: Thu, <span class="token number">31</span> Dec <span class="token number">2037</span> <span class="token number">23</span>:55:55 GMT
cache-control: max-age<span class="token operator">=</span><span class="token number">315360000</span>, public
access-control-allow-origin: *
via: <span class="token number">1.1</span> varnish
accept-ranges: bytes
date: Sun, <span class="token number">25</span> Aug <span class="token number">2019</span> <span class="token number">16</span>:47:44 GMT
via: <span class="token number">1.1</span> varnish
age: <span class="token number">12798556</span>
x-served-by: cache-jfk8128-JFK, cache-bur17527-BUR
x-cache: HIT, HIT
x-cache-hits: <span class="token number">785</span>, <span class="token number">4638</span>
x-timer: S1566751665.941825,VS0,VE0
vary: Cookie
content-length: <span class="token number">1306</span>
</code></pre></div><p>Fastly 缓存是否命中通过 x-cache 字段来描述，其字段值里只要存在 HIT ，则表明命中 CDN 缓存；只有当字段值为 MISS 和  MISS, MISS 时，才表明未命中 CDN 缓存。</p> <p>需要简单说明下，x-cache 字段的值为双个或单个，仅当此时最优的 CDN 节点为中心节点时为单值。倘若为双值，第一个值代表中心节点，第二个值代表边缘节点；倘若为单值，即代表中心节点。</p> <p>字段 x-served-by 和 x-cache-hits 与此类似，x-served-by 为 CDN 缓存节点标识，x-cache-hits 为 CDN 缓存命中数。</p></li></ul> <p>概括来说，CDN 命中状态的描述与其缓存服务器（ varnish、squid 及 nginx ）紧密相连，因本文面向前端人员，在此不做扩展。除了以上流行的 CDN 服务商，自建 CDN 服务也在科技公司中屡见不鲜，比如 Twitter 、Facebook、Netflix、网易等公司。自建的 CDN 服务在其可控性、定制化、安全性上具有诸多优势，同时可以降低成本、提升用户体验。</p> <p>静态资源的单次缓存命中情况不足以衡量网站加速的好坏，CDN 控制台的缓存命中率才是判断的标准。当网站资源 CDN 命中率低于50%，可以认为其命中率偏低，通常可以从缓存设置和资源本身两方面进行排查，具体如下：</p> <ul><li><p>缓存设置</p> <ul><li><p>源站响应头信息设置不当，主要指 cache-control 设置为 cache-control：no-cache/no-store/max-age=0/private 或 Pragma 设置为 no-cache</p></li> <li><p>CDN 控制台缓存配置不合理，CDN 缓存时间过短或未缓存</p></li></ul></li> <li><p>资源本身</p> <ul><li><p>源站动态资源偏多，动态资源需要回源处理</p></li> <li><p>访问 CDN 资源的 URL 具有可变参数，每次访问会被认为是新请求，会进行回源拉取</p></li> <li><p>资源文件热度不够，CDN 节点上缓存会按照热度进行末尾淘汰制</p></li> <li><p>CDN 资源刷新操作频繁，刷新缓存会让 CDN 节点重新回源，影响 CDN 命中率</p></li></ul></li></ul> <h2 id="cdn-回源"><a href="#cdn-回源" aria-hidden="true" class="header-anchor">#</a> CDN 回源</h2> <p>CDN 命中和 CDN 回源相辅相成，当 CDN 未命中时，请求资源需要进行 CDN 回源。与 CDN 命中率恰恰相反，CDN 回源率越高，通常表明网站加速效果不理想，对源站服务器没起到分流减压的作用。</p> <p>简单点说，当资源未命中 CDN 缓存，即 HTTP 响应头信息中 x-cache 或 x-cache-lookup 字段为 MISS 时，资源会发起回源请求。当然，也可能是 CDN 缓存设置或资源本身问题导致。</p> <p>CDN 回源需要在 CDN 控制台配置回源地址及回源 HOST ，否则会导致回源失败。两者区别如下：</p> <ul><li><p>回源地址指预先在 CDN 服务商处配置的源站服务器 IP 或 域名，用于无缓存资源、缓存过期或非缓存资源时，回溯至源站获取资源</p></li> <li><p>回源 HOST 指当源站服务器存在众多站点时，由回源 HOST 决定访问源站服务器上具体站点。需要注意，当回源 HOST 未配置时，默认会将其加速域名（ 以上述 cdn-static.snowball.site 为例 ）作为 回源 HOST；当回源 HOST 配置不正确时，会导致回源失败。</p></li></ul> <p>CDN 缓存时长对 CDN 回源率具有直接影响：倘若 CDN 缓存时长设置过短，CDN 节点上缓存容易过期，导致频繁回源，增大源站服务器负荷及访问延迟；倘若 CDN 缓存时长设置过长，CDN 节点上缓存不容易过期，会导致 CDN 资源更新滞后，影响用户体验。需要根据具体业务需求，指定合适的缓存时长，降低 CDN 回源率。</p> <h2 id="cdn-缓存"><a href="#cdn-缓存" aria-hidden="true" class="header-anchor">#</a> CDN 缓存</h2> <p>当网站引入 CDN 后，会依次经历 HTTP 缓存 和 CDN 节点缓存两个部分，简单点说，浏览器会先判断本地缓存（ 内存及硬盘 ）是否存在，若存在则直接使用；否则请求 CDN 节点。类似的，CDN 节点也会检测资源是否存在或过期，若存在并且未过期，则直接返回；否则向源站发起回源请求，返回对应资源并进行缓存。</p> <p>下面将从 HTTP 缓存 和 CDN 节点缓存两个部分来介绍：</p> <ul><li><p>HTTP 缓存</p> <p>HTTP 缓存为客户端缓存，可分为强缓存和协商缓存两大部分：</p> <ul><li><p>强缓存</p> <p>强缓存是指浏览器直接从本地缓存中获取数据，不需跟服务器进行通信。强缓存命中时，在 Chrome 浏览器上状态码如下：</p> <p><img src="/docs/assets/img/http_cache-1.2e652832.png" alt=""></p> <p><img src="/docs/assets/img/http_cache-2.ccff9329.png" alt=""></p> <div class="tip custom-block"><p class="custom-block-title">小贴士</p> <p>内存缓存( from memory cache )读取快速，并且进程一旦关闭则失效，具有时效性，以图片资源为主；硬盘缓存( from disk cache )读取稍慢，但存储在硬盘上，以 JavaScript、CSS 文件为主。</p></div> <p>当浏览器第一次跟服务器通信请求资源时，服务器会在返回对应资源的同时，在响应头信息中追加 Expires / Cache-Control 字段，用于后续请求的资源是否在有效期内的参考，倘若在有效期内，则命中强缓存，直接返回缓存中的资源，否则请求服务器，拉取最新资源。</p> <p>强缓存的命中与否通过 HTTP 头信息中字段 expires 或 cache-control 进行判断，但 cache-control 的优先度更高。Expires 是 HTTP/1.0 年代用于判断资源是否过期的依据，其值为绝对的 GMT 时间，举个例子：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Response Headers</span>
expires: Sun, <span class="token number">29</span> Sep <span class="token number">2019</span> <span class="token number">15</span>:05:50 GMT
<span class="token comment"># GMT 为格林尼治时间，北京处于东八区，需要加八小时处理</span>
<span class="token comment"># 当客户端再次请求该资源的时间超过北京时间 2019年9月29日 23:05:50 时，资源才做过期处理</span>
</code></pre></div><p>采用绝对时间的 Expires ，通过与客户端本地时间对比来判断资源是否过期，而本地时间具有不确定性，可能被更改造成缓存失效，因此 Expires 成为兼容方案，字段 Pragma: no-cache/public 同样也是如此。 在 HTTP/1.1 年代，为了解决 HTTP/1.0 中的瑕疵，融合并扩展 Pragma 和 Expires 两个字段的诸多功能，Cache-Control 应运而生。
Cache-Control 采用相对时间来判断资源是否过期，主要指令如下：</p> <ul><li><p>public / private</p> <p>表明响应可以被何种对象缓存，public 表明其可以被任何对象缓存；private 表明其只可以被单个用户缓存（ 非共享，不包括代理服务器 ）</p></li> <li><p>max-age / s-maxage</p> <p>设置缓存存储的最长时间，在这段时间内缓存生效，单位为秒。当字段存在时，倘若浏览器支持 HTTP/1.1 ，Expires 字段会被忽略。需要注意：s-maxage 会覆盖 max-age、expires，仅对共享缓存生效</p></li> <li><p>no-cache / no-store</p> <p>决定是否采用缓存，no-cache 并非不缓存，而是每次需要与服务器通信来验证是否采用缓存；no-store 则是不缓存。</p></li> <li><p>must-revalidate / stale-while-revalidate</p> <p>资源过期后处理方案，must-revalidate 表明资源过期后，必须重新进行验证后才可以使用；stale-while-revalidate 表明资源过期后，在其值规定的时间内可以继续使用，但后台会异步检查更新，在规定的时间之后，才会完全过期。需要注意，两字段不可同时存在，若同时存在，must-revalidate 会覆盖 stale-while-revalidate ；stale-while-revalidate 浏览器兼容性依旧较差。这两字段在浏览器端还存在些许问题，不推荐使用。</p></li></ul> <p>当需缓存静态资源时，如下设置：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># HTTP/1.1</span>
cache-control: public, max-age<span class="token operator">=</span><span class="token number">31536000</span>
<span class="token comment"># HTTP/1.0</span>
pragma: public
expires: Sun, <span class="token number">29</span> Sep <span class="token number">2019</span> <span class="token number">15</span>:05:50 GMT
</code></pre></div><p>当需完全禁用缓存时，如下设置：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># HTTP/1.1</span>
cache-control: no-cache, no-store, must-revalidate, private, max-age<span class="token operator">=</span><span class="token number">0</span>
<span class="token comment"># HTTP/1.0</span>
pragma: no-cache
<span class="token comment"># expires 为 0 不代表资源过期，代表非法的日期格式，适宜用过去的绝对时间来替代</span>
<span class="token comment"># https://tools.ietf.org/html/rfc2616#section-14.21</span>
<span class="token comment"># https://stackoverflow.com/questions/11357430/http-expires-header-values-0-and-1</span>
expires: Fri, 02 Jan <span class="token number">2000</span> 00:00:00 GMT
</code></pre></div></li> <li><p>协商缓存</p> <p>当强缓存未命中，即缓存资源过期，此时资源并不一定会发生改变，需要跟服务器进行验证是否可以继续使用缓存，这一过程称作协商缓存。</p> <p>协商缓存命中时，在 Chrome 浏览器上状态码如下：</p> <p><img src="/docs/assets/img/http_cache-3.921ec6ec.png" alt=""></p> <p>当浏览器第一次跟服务器通信请求资源时，服务器会在返回对应资源的同时，在响应头信息中追加 Last-Modified/ETag 字段，再次请求该资源时，会在请求头追加 If-Modified-Since/If-None-Match 字段（ Last-Modified 则追加 If-Modified-Since 字段，ETag 则追加 If-None-Match 字段，其值为上次返回的 Last-Modified/ETag 值 ），服务器再次接受到请求时会根据服务器上该资源现有 Last-Modified 字段或资源现有信息生成的 ETag 字段，前后进行对比（ If-Modified-Since 与 Last-Modified ，If-None-Match 与 ETag 两两对比是否相同 ），倘若一致，说明资源未进行修改，返回 304 ，从本地缓存中直接加载资源；倘若不一致，说明资源已经修改，返回 200 ，拉取最新资源。</p> <p>Last-Modified 是 HTTP/1.0 年代用于判断资源是否变更的依据，其值为服务器上绝对的 GMT 时间，举个例子：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Response Headers</span>
last-modified: Sun, <span class="token number">10</span> Mar <span class="token number">2019</span> 04:46:35 GMT
<span class="token comment"># GMT 为格林尼治时间，北京处于东八区，需要加八小时处理</span>
<span class="token comment"># 服务器端资源的最后修改时间为北京时间 2019年5月10日 12:46:35</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">小贴士</p> <p>当响应头中有 Last-Modified 字段，而缺失 Expire 或 Cache-Control 字段时，浏览器会采用默认缓存的方式计算该资源缓存的时间，不同浏览器的算法可能有所区别，因此 Last-modified 字段需要和 Expire 或 Cache-Control 字段配合使用。当然如果想禁用此类缓存，可以使用 <code>cache-control: no-cache</code> 来避免。</p></div> <p>Last-Modified 用来判断资源是否变更其实存在一些瑕疵：文件最后修改时间变更，但文件内容未变更，资源其实未变更；基于绝对时间，只能精确到秒，面对高频的变更乏力；部分服务器可能无法精确获取资源最后修改时间。在 HTTP/1.1 年代，为解决 Last-Modified 遗留的问题，引入了新标识符 ETag 。需要注意，ETag 优先度高于 Last-Modified。</p> <p>ETag 通常是资源文件目录及最后修改时间戳两者哈希化取值而来，当然也可以简单使用版本号。示例如下：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 弱验证器以 &quot;W/&quot; 开头，弱验证器易生成，但不利于比较</span>
<span class="token comment"># 弱验证器可以用于处理一秒内资源的高频变更，避免强验证器频繁更新的问题</span>
<span class="token comment"># https://unpkg.zhimg.com/@cfe/sentry-script@0.0.10/dist/init.js</span>
etag: W/<span class="token string">&quot;9b04-166e2db7c58&quot;</span>
<span class="token comment"># 哈希值</span>
<span class="token comment"># https://pic3.zhimg.com/v2-b486df80ba5511d62fef808ffaa4b701_1200x500.jpg</span>
etag: <span class="token string">&quot;B486DF80BA5511D62FEF808FFAA4B701&quot;</span>
<span class="token comment"># 版本号</span>
<span class="token comment"># https://cdn-images-1.medium.com/fit/c/304/312/1*ClhcyPdKJp-T3L3AIup00Q.jpeg</span>
etag: <span class="token string">&quot;16.3&quot;</span>
</code></pre></div></li></ul> <p>HTTP 缓存整体流程图如下：</p> <p><img src="/docs/assets/img/http_cache-flow.b7447e22.svg" alt=""></p></li> <li><p>CDN 节点缓存</p> <p>CDN 节点缓存为服务端缓存，各服务商间的实现有所不同，但都遵循 HTTP 协议，一般通过响应头信息 expires 及 cache-control 中 max-age 字段来控制其缓存时间。<strong>需要注意，当源站服务器响应头包含 cache-control 时，CDN 缓存时长遵循源站缓存规则。</strong></p> <p>其实 CDN 节点缓存流程与 HTTP 缓存大体类似，在资源是否过期这部分通过响应头信息 Expires/Cache-Control 来控制，在资源是否变更这部分通过 If-None-Match/If-Modified-Since 请求头信息来验证。不同的是，HTTP 缓存相对于源站而言；CDN 节点缓存在浏览器与源站之间，增加了 CDN 缓存服务器。</p> <p>CDN 节点缓存流程大致如下：当浏览器第一次向 CDN 边缘节点通信请求资源时，服务器会在返回对应资源的同时，在响应头信息中追加 Expires/Cache-Control 字段 及 Last-Modified/ETag 字段，再次请求该资源时，通过 Expires/Cache-Control 字段检测资源是否过期，倘若未过期，则强缓存命中，从本地缓存中读取资源；否则请求 CDN 边缘节点。该边缘节点检测该资源是否在缓存中（ X-Cache/X-Cache-Lookup 字段），倘若在其缓存中并且未过期，则直接返回；否则请求 CDN 中心节点。该中心节点检测该资源是否在缓存中，倘若其缓存中并且未过期，则返回资源至 CDN 边缘节点；否则进行回源处理。
该 CDN 中心节点向源站发起回源校验请求，请求头信息附加 If-Modified-Since/If-None-Match 字段，源站服务器根据前后 Last-Modified/ETag 字段进行对比，倘若一致，说明资源未进行修改，返回 304 ，CDN 节点会保留当前的缓存，并将该文件设置为未过期，而且在文件缓存时间到期前不会再次回源校验；倘若不一致，说明资源已经修改，返回 200 ，CDN 节点会删除旧的缓存内容，从源服务器上同步新的资源并缓存。</p> <p>CDN 节点缓存整体流程图如下：</p> <p><img src="/docs/assets/img/cdn_cache-flow.1df9507f.svg" alt=""></p></li></ul> <h2 id="cdn-更新"><a href="#cdn-更新" aria-hidden="true" class="header-anchor">#</a> CDN 更新</h2> <p>缓存说白了，就是用空间换取时间。缓存可以优化 Web 性能，但也是一把双刃剑，当网站资源需要更新时，可能因缓存导致更新滞后，影响用户体验。</p> <p>与 CDN 缓存类似，CDN 更新也需要从 HTTP 缓存及 CDN 节点缓存两个维度去考虑：</p> <ul><li><p>HTTP 缓存</p> <p>HTTP 缓存这个维度主要是本地缓存的更新问题，以 Chrome 浏览器为例，提供了三种方式来控制本地缓存：</p> <ul><li><p>开发者工具里 <code>Disable cache</code> 设置项</p> <p><img src="/docs/assets/img/cdn_1.d5e84eb9.png" alt=""></p> <div class="tip custom-block"><p class="custom-block-title">小贴士</p> <p>Disable cache 的配置<strong>仅在开发者工具打开时生效</strong>，具体可查阅：<a href="https://twitter.com/ChromiumDev/status/227356682890670080" target="_blank" rel="noopener noreferrer">Chrome DevTools' Disable Cache<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div></li> <li><p>开发者模式下网页刷新设置项</p> <p><img src="/docs/assets/img/cdn_2.c7c60a55.png" alt=""></p> <p><strong>该设置项需要按住刷新按钮才可查看，需要打开 Chrome 开发者工具</strong>，各设置项功能如下：</p> <ul><li><p>正常重新加载（ Normal Reload ）</p> <p>常规刷新网页操作，等同于 Windows 下的 <code>F5</code> 或 Mac 下的 <code>Command</code> + <code>R</code> 。此操作在刷新页面时会利用本地缓存，可以避免静态资源的重新下载，通常用于网站动态资源的刷新。</p></li> <li><p>硬性重新加载（ Hard Reload ）</p> <p>强制刷新网页操作，等同于 Windows 下的 <code>Shift</code> + <code>F5</code> 或 Mac 下的 <code>Shift</code> + <code>Command</code> + <code>R</code> 。此操作会强制网站向服务器重新发起请求，请求头信息追加 <code>cache-control: no-cache</code> ，告知服务器不使用本地缓存（ 并不会清空缓存 ），通常用于网站静态资源的刷新。</p></li> <li><p>清空缓存并硬性重新加载（ Empty Cache and Hard Reload ）</p> <p>清空浏览器所有本地缓存并强制刷新当前页面，与硬性重新加载有所不同的是，硬性重新加载依然会存在利用缓存的边缘情况，比如非页面加载周期的脚本存在下载资源行为（ 举个例子，页面下载歌曲及报表的操作 ）。简单点说，硬性重新加载不使用本地缓存仅适用于页面加载周期内，而清空缓存并硬性重新加载不使用本地缓存适用于页面整个生命周期。</p></li></ul></li> <li><p>浏览器设置中清除浏览数据选项</p> <p><img src="/docs/assets/img/cdn_3.1b26d9e1.png" alt=""></p> <p>清除浏览数据可在 Chrome 地址栏通过 <code>chrome://settings/clearBrowserData</code> 地址直接访问。</p> <p>清除浏览数据选项只用于清空浏览器所有本地缓存，需与正常重新加载按钮配合，才能实现上方清空缓存并硬性重新加载的功能。</p></li></ul> <p>除此之外，浏览器前进后退缓存（ Backward/Forward Cache，可简称 BF Cache ）也值得关注，主要表现为 DOM 结构及 JavaScript 对象（ 甚至 Ajax 请求 ）被缓存，可参阅：<a href="https://developers.google.com/web/updates/2019/02/back-forward-cache" target="_blank" rel="noopener noreferrer">Exploring a back/forward cache for Chrome<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。这项旨在提升页面切换的速度，也会带来缓存更新的问题，通常可以通过监听 pageshow 事件 及 pagehide 事件，触发事件时强刷页面来解决。</p> <p>上方大部分方案是面向开发者的，普通用户的本地缓存如何不需手动操作而快速更新呢？通常利用 Webpack 插件打包时在资源文件名中嵌入该文件的指纹或版本号来实现，例如 <code>cdn.<strong>74ab055</strong>.png</code> 。由于图片地址变更，浏览器会强制用户下载新图片，便完成了新旧静态资源的替换。</p> <p><strong>单页面应用中，由于只存在一个入口文件 <code>index.html</code> ，此文件更新同步度要求较高，适宜在 Web 服务器响应头信息追加 <code>cache-control: no-cache</code> 字段，即每次都需要与服务器进行验证；而 CSS 、JavaScript、Image、Font等非 CDN 静态资源文件，可通过哈希化标示的文件名区分以便更新</strong>。</p></li> <li><p>CDN 节点缓存</p> <p>当源站服务器更新后，如果 CDN 节点上资源未完全同步，先前缓存还未过期，那访问到的资源依旧是过期资源，此时需要手动刷新 CDN 资源，分为如下两种方式：</p> <ul><li><p>主动刷新</p> <p>主动刷新是指将源站资源更新后，将资源从源站分发至 CDN 各节点的缓存中这个过程，这种主动分发技术称为 PUSH（ 分发 ）。CDN 服务商通常会提供 URL 刷新、目录刷新及 URL 预热三个可选项：</p> <ul><li><p>URL 刷新（ 少量刷新 ）</p> <p>强制将 CDN 缓存节点上的指定资源文件设置为过期，致使其回源拉取最新资源。</p></li> <li><p>目录刷新（ 批量刷新 ）</p> <p>强制将 CDN 缓存节点上的指定文件目录中的文件设置为过期，致使其回源拉取最新资源。</p></li> <li><p>URL 预热（ 提前缓存 ）</p> <p>将指定资源文件提前缓存到全网 CDN 节点，当用户请求 CDN 节点时，无需回源直接获取资源。</p></li></ul></li> <li><p>被动刷新</p> <p>被动刷新是指当资源在 CDN 节点缓存中过期后，该 CDN 节点服务器从源站或其他节点拉取资源这个过程，这种被动分发技术称为 PULL（ 回源 ）。整个过程由 CDN 自动完成，无需手动操作。</p></li></ul> <p>主动刷新 CDN 缓存后，会在 CDN 各节点的缓存中删除该资源，当用户重新请求该资源时，CDN 节点会回源拉取并缓存，从而达成资源更新的目的。被动刷新 CDN 缓存需要等待该资源在 CDN 节点缓存中过期，过期后再次请求时，CDN 节点才会回源拉取并缓存，进而完成资源更新的目的。其实，不管主动还是被动，都需要进行回源拉取资源（ 除 URL 预热外），区别在于 CDN 节点缓存中的资源是主动过期还是被动过期。从更新效率来看，<strong>通常会选择主动刷新 CDN 缓存操作，全网刷新生效时长为 10 分钟左右</strong>。</p></li></ul> <h2 id="参考链接"><a href="#参考链接" aria-hidden="true" class="header-anchor">#</a> 参考链接</h2> <ul><li><p><a href="https://zh.wikipedia.org/wiki/%E5%85%A7%E5%AE%B9%E5%82%B3%E9%81%9E%E7%B6%B2%E8%B7%AF" target="_blank" rel="noopener noreferrer">维基百科 - 内容分发网络<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://zhuanlan.zhihu.com/p/52362950" target="_blank" rel="noopener noreferrer">到底什么是CDN？<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://segmentfault.com/a/1190000010631404" target="_blank" rel="noopener noreferrer">CDN详解<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://www.imperva.com/learn/performance/what-is-cdn-how-it-works/" target="_blank" rel="noopener noreferrer">what-is-cdn-how-it-works<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://www.keycdn.com/support/origin-shield" target="_blank" rel="noopener noreferrer">Origin Shield - Extra CDN Caching Layer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://www.zhihu.com/question/20024922" target="_blank" rel="noopener noreferrer">CDN加速对动态网站有影响吗？<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="http://genie88.github.io/2015/11/03/talk-about-content-delivery-network-and-caches/" target="_blank" rel="noopener noreferrer">CDN缓存那些事儿<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://pantheon.io/docs/test-global-cdn-caching" target="_blank" rel="noopener noreferrer">Testing Global CDN Caching<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://community.akamai.com/customers/s/article/Using-Akamai-Pragma-headers-to-investigate-or-troubleshoot-Akamai-content-delivery?language=en_US" target="_blank" rel="noopener noreferrer">Using Akamai Pragma headers to investigate or troubleshoot Akamai content delivery<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://support.globaldots.com/hc/en-us/articles/115003996705-Akamai-Pragma-Headers-overview" target="_blank" rel="noopener noreferrer">Akamai - Pragma Headers overview<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://support.cloudflare.com/hc/en-us/articles/200168266-What-do-the-various-Cloudflare-cache-responses-HIT-Expired-etc-mean-" target="_blank" rel="noopener noreferrer">What do the various Cloudflare cache responses (HIT, Expired, etc.) mean?<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://docs.fastly.com/en/guides/understanding-cache-hit-and-miss-headers-with-shielded-services" target="_blank" rel="noopener noreferrer">Understanding cache HIT and MISS headers with shielded services<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://www.zhihu.com/question/20143441" target="_blank" rel="noopener noreferrer">varnish / squid / nginx cache 有什么不同？<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://help.aliyun.com/knowledge_detail/63874.html" target="_blank" rel="noopener noreferrer">阿里云 - CDN命中率低<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://zhuanlan.zhihu.com/p/34314554" target="_blank" rel="noopener noreferrer">CDN回源Host的意义<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/http-caching" target="_blank" rel="noopener noreferrer">HTTP 缓存<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://zhuanlan.zhihu.com/p/29750583" target="_blank" rel="noopener noreferrer">HTTP 缓存机制一二三<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://stackoverflow.com/questions/10314174/difference-between-pragma-and-cache-control-headers" target="_blank" rel="noopener noreferrer">Difference between Pragma and Cache-control headers?<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://zhuanlan.zhihu.com/p/48197254" target="_blank" rel="noopener noreferrer">图解浏览器缓存，教你提高用户体验<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://zhuanlan.zhihu.com/p/60357719" target="_blank" rel="noopener noreferrer">可能是最被误用的 HTTP 响应头之一 Cache-Control: must-revalidate<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://medium.com/pixelpoint/best-practices-for-cache-control-settings-for-your-website-ff262b38c5a2" target="_blank" rel="noopener noreferrer">Best practices for cache control settings for your website<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://zhuanlan.zhihu.com/p/64694485" target="_blank" rel="noopener noreferrer">Cache-Control 的 stale-while-revalidate 指令<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://stackoverflow.com/questions/14969315/whats-the-difference-between-normal-reload-hard-reload-and-empty-cache-a#14969509" target="_blank" rel="noopener noreferrer">What's the difference between “Normal Reload”, “Hard Reload”, and “Empty Cache and Hard Reload” in Chrome?<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://juejin.im/post/5a098b5bf265da431a42b227" target="_blank" rel="noopener noreferrer">Web静态资源缓存及优化<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://zhuanlan.zhihu.com/p/65722520" target="_blank" rel="noopener noreferrer">聊聊 CDN 缓存与浏览器缓存<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://cloud.tencent.com/document/product/228/11204" target="_blank" rel="noopener noreferrer">缓存刷新问题<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/Damo-web/docs/edit/master/docs/engineering/cdn.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2019-09-04 05:33:12 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/engineering/domain.html" class="prev">Domain</a></span> <!----></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/docs/assets/js/app.bb5e32e8.js" defer></script><script src="/docs/assets/js/2.3b5bc873.js" defer></script><script src="/docs/assets/js/7.b57c8ee5.js" defer></script><script src="/docs/assets/js/22.e56f6488.js" defer></script>
  </body>
</html>
