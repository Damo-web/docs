(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{322:function(t,n,s){t.exports=s.p+"assets/img/vdom_1.a2085b6f.png"},323:function(t,n){t.exports="data:image/png;base64,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"},324:function(t,n,s){t.exports=s.p+"assets/img/vdom_4.c2da2aaa.png"},325:function(t,n,s){t.exports=s.p+"assets/img/vdom_5.055181bd.png"},326:function(t,n,s){t.exports=s.p+"assets/img/vdom_6.9b64430d.png"},327:function(t,n,s){t.exports=s.p+"assets/img/vdom_7.826d8ee6.png"},328:function(t,n,s){t.exports=s.p+"assets/img/vdom_8.41264b4e.png"},329:function(t,n,s){t.exports=s.p+"assets/img/vdom_9.0a70f75f.png"},330:function(t,n,s){t.exports=s.p+"assets/img/vdom_10.15f83705.png"},331:function(t,n,s){"use strict";var a=s(99);s.n(a).a},380:function(t,n,s){"use strict";s.r(n);s(331);var a=s(2),e=Object(a.a)({},function(){var t=this,n=t.$createElement,a=t._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"virtual-dom"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#virtual-dom","aria-hidden":"true"}},[t._v("#")]),t._v(" Virtual DOM")]),t._v(" "),a("blockquote",[a("p",[t._v("在现代web前端框架中，虚拟DOM是一个不可避免谈论的话题。初识虚拟DOM，会对它非常好奇，但大部分人可能只停留在框架使用层面，对其diff过程不太清楚。本栏目旨在实现类mpVue类的跨端平台简易版本，会持续进行文档记录。而首当其冲，需要去了解Vue2.0+版本背后，虚拟DOM的运行机制及原理。")])]),t._v(" "),a("p",[t._v("当翻阅Vue的源码，在其"),a("a",{attrs:{href:"https://github.com/vuejs/vue",target:"_blank",rel:"noopener noreferrer"}},[t._v("github"),a("OutboundLink")],1),t._v("上dev分支vue/src/core/vdom/patch.js目录下，注明了Vue有关虚拟DOM的diff算法是借鉴"),a("a",{attrs:{href:"https://github.com/snabbdom/snabbdom",target:"_blank",rel:"noopener noreferrer"}},[t._v("Snabbdom"),a("OutboundLink")],1),t._v("这个开源库来实现的。\n下述文档会就Snabbdom的diff算法进行源码层面的分析和解读。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * Virtual DOM patching algorithm based on Snabbdom by\n * Simon Friis Vindum (@paldepind)\n * Licensed under the MIT License\n * https://github.com/paldepind/snabbdom/blob/master/LICENSE\n *\n * modified by Evan You (@yyx990803)\n *\n * Not type-checking this because this file is perf-critical and the cost\n * of making flow understand it is not worth it.\n */")]),t._v("\n")])])]),a("h2",{attrs:{id:"简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简介","aria-hidden":"true"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),a("p",[t._v("虚拟DOM本质是真实DOM抽象化，实质是用 JS 对象的方式来模拟真实的 DOM及节点。大体如下：")]),t._v(" "),a("p",[a("img",{attrs:{src:s(322),alt:""}})]),t._v(" "),a("h2",{attrs:{id:"diff算法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#diff算法","aria-hidden":"true"}},[t._v("#")]),t._v(" Diff算法")]),t._v(" "),a("p",[t._v("虚拟DOM其实就是模拟真实的 DOM 的 JS 对象，但仅有DOM抽象化模型，无法解决Web UI操作更新DOM后所引发页面渲染问题。为了解决页面操作引发更新DOM的问题，"),a("strong",[t._v("还需要对前后两次DOM节点变化进行对比，计算出虚拟DOM中真正变化的部分，并针对该部分进行真实 DOM 操作")]),t._v("，而非一更新DOM全部重新渲染页面。而上述这个比对并更新DOM的过程，就是虚拟DOM中的Diff算法。")]),t._v(" "),a("p",[t._v("将一棵树转换成另一棵树的最小操作次数，"),a("strong",[t._v("传统Diff算法是通过循环递归对节点进行依次对比，算法复杂度达到 O(n^3)")]),t._v("，其中 n 是树中节点的总数。传统Diff算法，论性能及效率，在前端渲染层是难以接受的。")]),t._v(" "),a("p",[t._v("React 通过以下的约定，实现了"),a("strong",[t._v("算法复杂度从O(n^3)降到O(n)")]),t._v("，保证了UI渲染的性能:")]),t._v(" "),a("p",[a("strong",[t._v("1. 不同类型的节点将生成不同的DOM Tree")])]),t._v(" "),a("p",[a("strong",[t._v("2. 对于同一层级的一组子节点，它们可以通过唯一 Key 进行区分")])]),t._v(" "),a("p",[a("strong",[t._v("3. DOM 节点跨层级的操作特别少，可以忽略，即使出现，删除旧节点新建DOM节点即可")])]),t._v(" "),a("img",{attrs:{src:s(323),width:"100%"}}),t._v(" "),a("h2",{attrs:{id:"diff源码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#diff源码","aria-hidden":"true"}},[t._v("#")]),t._v(" Diff源码")]),t._v(" "),a("p",[t._v("Snabbdom关于虚拟DOM及Diff算法与React其实是类似的。下文以Snabbdom为例，从代码层面剖析了构建虚拟DOM 及 Diff的过程：")]),t._v(" "),a("ul",[a("li",[t._v("DOM抽象化模型vnode")])]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 虚拟DOM生成函数\n * @param {selector}                元素选择器\n * @param {data}                    元素标签属性及key\n * @param {children}                元素子元素\n * @param {text}                    元素纯文本节点                    \n * @param {elm}                     元素真实dom（render时）\n */")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("VNode")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("selector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" children"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" elm")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" key "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" data "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      selector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      children"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      elm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      key\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"tip custom-block"},[a("p",[t._v("值得注意的是，Snabbdom约定了text与children不可并存，作为区分文本节点和非文本节点的标志,当text与children共存时，忽略text属性")])]),t._v(" "),a("ul",[a("li",[t._v("新旧节点patch")])]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("patch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("oldVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("vnode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" elm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("parent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//若oldVnode为 真实Element")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//则转化oldVnode为空节点")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isVnode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      oldVnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("emptyNodeAt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//对比新旧节点")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sameVnode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//新旧节点为相同节点(selector和key相同)则patch")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("patchVnode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取新旧节点及父级")]),t._v("\n      elm "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      parent "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("parentNode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("elm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElm")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//倘若父级节点存在")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//在父级节点下旧节点后插入新节点")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//删除旧节点")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parent "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertBefore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextSibling")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("elm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeVnodes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("oldVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[t._v("新旧节点patchVnode")])]),t._v(" "),a("div",{staticClass:"language-javascript code-contain extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//patch node")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("patchVnode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("oldVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" hook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" elm "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" oldCh "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("children"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ch "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("children"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//若data.hook.prepatch存在，则执行prepatch hook")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Validator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" Validator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("hook "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" Validator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" hook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prepatch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("i")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//新旧节点完全相同")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//触发update hook")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Validator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" cbs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("update"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        cbs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("update"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Validator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" Validator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("update"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("i")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Validator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isUndef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//新节点非文本节点")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Validator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" Validator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//新旧节点都含有子元素")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//则更新子元素")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldCh "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" ch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateChildren")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("elm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Validator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//新节点有子元素，旧节点无子元素")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Validator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTextContent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("elm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addVnodes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("elm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Validator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//新节点无子元素，旧节点有子元素")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeVnodes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("elm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Validator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//旧节点为文本节点")]),t._v("\n        api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTextContent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("elm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//新节点为文本节点")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Validator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeVnodes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("elm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTextContent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("elm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//若data.hook.postpatch存在，则执行postpatch hook")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Validator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("hook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" hook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postpatch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("i")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[t._v("新旧节点updateChildren")])]),t._v(" "),a("div",{staticClass:"language-javascript code-contain extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateChildren")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("parentElm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取 oldCh, newCh 首尾index")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" oldStartIdx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("oldEndIdx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" newStartIdx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("newEndIdx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取 oldCh, newCh 首尾node")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" oldStartVnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("oldEndVnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("oldEndIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" newStartVnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("newEndVnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("newEndIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" oldKeyToIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("idxInOld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("elmToMove"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("before"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartIdx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" oldEndIdx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" newStartIdx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" newEndIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//确保oldStartVnode,oldEndVnode,newStartVnode,newEndVnode存在")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartVnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Vnode might have been moved")]),t._v("\n        oldStartVnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("oldStartIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldEndVnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        oldEndVnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("oldEndIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newStartVnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        newStartVnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("newStartIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newEndVnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        newEndVnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("newEndIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//当oldStartVnode与newStartVnode属于同一节点")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//或者oldEndVnode与newEndVnode属于同一节点")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Vnode 往中间偏移")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sameVnode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("patchVnode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        oldStartVnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("oldStartIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        newStartVnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("newStartIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sameVnode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldEndVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newEndVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("patchVnode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldEndVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newEndVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        oldEndVnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("oldEndIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        newEndVnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("newEndIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//当oldStartVnode与newEndVnode属于同一节点")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Vnode 往右偏移")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sameVnode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newEndVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("patchVnode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newEndVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertBefore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentElm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldStartVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextSibling")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldEndVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        oldStartVnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("oldStartIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        newEndVnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("newEndIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//当oldEndVnode与newStartVnode属于同一节点")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Vnode 往左偏移")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sameVnode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldEndVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("patchVnode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldEndVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertBefore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentElm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldEndVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldStartVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        oldEndVnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("oldEndIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        newStartVnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("newStartIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//当oldStartVnode,oldEndVnode,newStartVnode,newEndVnode都是不同的节点")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//oldKeyToIdx不存在，则oldCh追加key")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Validator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isUndef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldKeyToIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          oldKeyToIdx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createKeyToOldIdx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldStartIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldEndIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//通过newStartVnode的key去获取idxInOld")]),t._v("\n        idxInOld "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldKeyToIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("newStartVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//判断idxInOld是否存在")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Validator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isUndef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("idxInOld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//若idxInOld不存在，则为新元素")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//创建新元素，并插入到旧节点之前")]),t._v("\n          api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertBefore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentElm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElm")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newStartVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldStartVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          newStartVnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("newStartIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//若idxInOld存在，则oldCh有相同 key 的 vnode")]),t._v("\n          elmToMove "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("idxInOld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//判断新旧node selector是否相同")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("elmToMove"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("selector "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" newStartVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("selector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//若selector不同，则新建dom")]),t._v("\n            api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertBefore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentElm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElm")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newStartVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldStartVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//若selector相同,key也相同")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("patchVnode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("elmToMove"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将当前 oldCh[idxInOld] 置空，等下次循环到这个下标的时候直接跳过")]),t._v("\n            oldCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("idxInOld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertBefore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentElm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" elmToMove"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldStartVnode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          newStartVnode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("newStartIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//处理异常情况，oldCh或newCh还有待处理子项")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartIdx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" oldEndIdx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" newStartIdx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" newEndIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartIdx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" oldEndIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//追加newCh")]),t._v("\n        before "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("newEndIdx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" newCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("newEndIdx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addVnodes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentElm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" before"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newEndIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//删除oldCh")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeVnodes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentElm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldCh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldStartIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldEndIdx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("div",{staticClass:"tip custom-block"},[a("p",[t._v("简单来说，新旧节点每次都会进行首首、尾尾、首尾节点的对比，若都不存在，会到旧节点中去匹配是否存在，若不存在，则为新节点；若存在，则打上循环至此跳过的标识，继续进行匹配。")])]),t._v(" "),a("h2",{attrs:{id:"diff逻辑图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#diff逻辑图","aria-hidden":"true"}},[t._v("#")]),t._v(" Diff逻辑图")]),t._v(" "),a("img",{staticClass:"zoomable",attrs:{src:s(324),width:"100%"}}),t._v(" "),a("h2",{attrs:{id:"updatechildren流程图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#updatechildren流程图","aria-hidden":"true"}},[t._v("#")]),t._v(" UpdateChildren流程图")]),t._v(" "),a("p",[t._v("因UpdateChildren的逻辑流程较复杂，举个例子来演绎下流程。")]),t._v(" "),a("p",[t._v("假定旧节点oldNode=[A,B,C,D],\n新节点newNode=[D,B,A,F,E]，oldS、oldE分别代表oldNode首尾项，\nnewS、newE分别代表newNode首尾项，以节点名（即A,B,C等）为key，整个UpdateChildren的流程如下：")]),t._v(" "),a("ol",[a("li",[t._v("oldE与newS为同一节点，newS往右偏移，oldE往左偏移")])]),t._v(" "),a("p",[a("img",{attrs:{src:s(325),alt:""}})]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("都不为同一节点，取newS所在的B节点到oldCh中匹配，匹配到同一节点，清空oldCh中B节点，newS往右偏移")])]),t._v(" "),a("p",[a("img",{attrs:{src:s(326),alt:""}})]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("newS与oldS为同一节点，newS往右偏移，oldS往右偏移")])]),t._v(" "),a("p",[a("img",{attrs:{src:s(327),alt:""}})]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[t._v("oldS中B节点为undefined，oldS往右偏移")])]),t._v(" "),a("p",[a("img",{attrs:{src:s(328),alt:""}})]),t._v(" "),a("ol",{attrs:{start:"5"}},[a("li",[t._v("都不为同一节点，取newS所在的F节点到oldCh中匹配，匹配不到，则为新节点，追加新节点")])]),t._v(" "),a("p",[a("img",{attrs:{src:s(329),alt:""}})]),t._v(" "),a("ol",{attrs:{start:"6"}},[a("li",[t._v("oldS大于oldE，updateChildren遍历完，但newCh中还有节点，追加新节点")])]),t._v(" "),a("p",[a("img",{attrs:{src:s(330),alt:""}})]),t._v(" "),a("h2",{attrs:{id:"总论"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总论","aria-hidden":"true"}},[t._v("#")]),t._v(" 总论")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("元素设置key的必要性")]),t._v(" "),a("p",[t._v("倘若元素不设置key，oldS、oldE、newS、newE会进行两两对比，若都不相同，则插入新元素newStartNode.elm，newS往右偏移，再进行对比；")]),t._v(" "),a("p",[t._v("倘若元素设置key，oldS、oldE、newS、newE同样会进行两两对比，若都不相同，则会用"),a("strong",[t._v("newS的key去查找oldCh中匹配的节点，如果能匹配到，则进行dom移动，否则，则作为新元素插入，因此可以更加高效利用DOM")]),t._v("。")])]),t._v(" "),a("li",[a("p",[t._v("虚拟DOM并不比操作真实DOM快")]),t._v(" "),a("p",[t._v("可以参阅知乎话题 "),a("a",{attrs:{href:"https://www.zhihu.com/question/31809713/answer/53780674",target:"_blank",rel:"noopener noreferrer"}},[t._v("网上都说操作真实 DOM 慢，但测试结果却比 React 更快，为什么？"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("综合来说，虚拟DOM的优势并不是在性能层面，但虚拟DOM的性能也不差，具体需要看渲染场景")])]),t._v(" "),a("li",[a("p",[t._v("虚拟DOM解决的前端痛点："),a("strong",[t._v("性能均衡、工程效率及平台化")])]),t._v(" "),a("p",[t._v("在复杂的界面环境下，DOM的操作成本非常高，会频繁触发DOM Reflow 和 Repaint，而虚拟DOM的出现，使得在"),a("strong",[t._v("真实DOM与Model操作之间建立一道缓冲带")]),t._v("成为可能。翻阅Snabbdom源码，也能看出，虚拟DOM及Diff过程，实质也在操作真实DOM，但通过Diff算法明显"),a("strong",[t._v("提升了DOM的复用效率")]),t._v("。综合来看，其在"),a("strong",[t._v("DOM大小更新场景下都能取得极佳的平衡点")]),t._v("。")]),t._v(" "),a("p",[t._v("恰恰是虚拟DOM的引入，声明式的前端开发才开始登上舞台。相比命令式的前端开发，声明式"),a("strong",[t._v("不再需要处理ViewModel，只需关注Model层")]),t._v("即可，极大简化了WebAPP的复杂度，提升了开发效率。")]),t._v(" "),a("p",[t._v("虚拟DOM的出现，完成了"),a("strong",[t._v("Model至View的映射，即UI = Vm（data）")]),t._v("，也打开了函数式的 UI 编程的大门（React）。既然是Model至View的映射，"),a("strong",[t._v("通过编译工具，能极大提升跨平台性")]),t._v("，使得跨IOS、Android及小程序成为可能（weex、reactNative及mpVue）。")])])]),t._v(" "),a("h2",{attrs:{id:"参考链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考链接","aria-hidden":"true"}},[t._v("#")]),t._v(" 参考链接")]),t._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://github.com/snabbdom/snabbdom",target:"_blank",rel:"noopener noreferrer"}},[t._v("snabbdom"),a("OutboundLink")],1)])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://reactjs.org/docs/reconciliation.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("React Reconciliation"),a("OutboundLink")],1)])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://juejin.im/post/5b9200865188255c672e8cfd",target:"_blank",rel:"noopener noreferrer"}},[t._v("snabbdom 源码阅读分析"),a("OutboundLink")],1)])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/20346379",target:"_blank",rel:"noopener noreferrer"}},[t._v("React 源码剖析系列 － 不可思议的 react diff"),a("OutboundLink")],1)])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://www.zhihu.com/question/31809713/answer/53780674",target:"_blank",rel:"noopener noreferrer"}},[t._v("网上都说操作真实 DOM 慢，但测试结果却比 React 更快，为什么？"),a("OutboundLink")],1)])])]),t._v(" "),a("h2",{attrs:{id:"附录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#附录","aria-hidden":"true"}},[t._v("#")]),t._v(" 附录")]),t._v(" "),a("p",[t._v("个人源码分析版本地址：\n"),a("a",{attrs:{href:"https://github.com/Damo-web/vdom",target:"_blank",rel:"noopener noreferrer"}},[t._v("vdom"),a("OutboundLink")],1)])])},[],!1,null,null,null);n.default=e.exports},99:function(t,n,s){}}]);