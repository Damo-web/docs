(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{253:function(t,s,a){t.exports=a.p+"assets/img/drone_1.ea73dcc2.png"},254:function(t,s,a){t.exports=a.p+"assets/img/drone_2.e370d563.png"},255:function(t,s,a){t.exports=a.p+"assets/img/drone_3.15bcf554.png"},256:function(t,s,a){t.exports=a.p+"assets/img/drone_4.24804a54.png"},257:function(t,s,a){t.exports=a.p+"assets/img/drone_5.fcade219.png"},258:function(t,s,a){t.exports=a.p+"assets/img/drone_6.6acaf0eb.png"},259:function(t,s,a){t.exports=a.p+"assets/img/drone_7.3a40f544.png"},260:function(t,s,a){t.exports=a.p+"assets/img/drone_8.bc110aa7.png"},365:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"drone-ci"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#drone-ci","aria-hidden":"true"}},[t._v("#")]),t._v(" Drone CI")]),t._v(" "),n("blockquote",[n("p",[t._v("本篇目为 Drone CI 搭建指南，以静态博客为例，覆盖构建、发布及通知流程。")])]),t._v(" "),n("h2",{attrs:{id:"前言"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前言","aria-hidden":"true"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),n("p",[t._v("Drone 是一个用 Go 语言开发的基于容器运行的开源持续集成软件，因其易于安装，配置简单，体积轻巧，成为当下最受欢迎的开源 CI / CD 工具。")]),t._v(" "),n("h2",{attrs:{id:"说明"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#说明","aria-hidden":"true"}},[t._v("#")]),t._v(" 说明")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://drone.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Drone"),n("OutboundLink")],1),t._v(" 是容器化的 CI / CD 工具，使用前需要了解  "),n("a",{attrs:{href:"https://damo-web.github.io/docs/server/docker.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker"),n("OutboundLink")],1),t._v(" 前置知识，通过简单配置 "),n("code",[t._v(".drone.yml")]),t._v(" 文件即可运行 CI / CD 服务。")]),t._v(" "),n("h2",{attrs:{id:"安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),n("p",[t._v("本篇以阿里云 CentOS7 系统为例，演示了 Drone 整个安装过程。")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("安装 Docker")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Install required packages")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -y yum-utils device-mapper-persistent-data lvm2\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Set up the stable repository")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Install docker-ce")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" docker-ce\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Enable docker")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" docker\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Start Docker")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl start docker\n")])])])]),t._v(" "),n("li",[n("p",[t._v("安装 Docker Compose")]),t._v(" "),n("p",[t._v("因 Drone 由 drone-ui 、drone-agent 和 drone-server 三个服务组合，每个服务都是独立的容器，此时需要 Docker Compose 来编排多容器应用。")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Download the current stable release of Docker Compose")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -L "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://github.com/docker/compose/releases/download/1.24.0/docker-compose-'),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("uname")]),t._v(" -s"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("-"),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("uname")]),t._v(" -m"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v('"')]),t._v(" -o /usr/local/bin/docker-compose\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Apply executable permissions")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" +x /usr/local/bin/docker-compose\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Link your path")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" -s /usr/local/bin/docker-compose /usr/bin/docker-compose\n")])])])]),t._v(" "),n("li",[n("p",[t._v("配置 Github OAuth Apps")]),t._v(" "),n("ul",[n("li",[t._v("注册 Github OAuth Apps 可参阅："),n("a",{attrs:{href:"https://developer.github.com/apps/building-oauth-apps/creating-an-oauth-app/",target:"_blank",rel:"noopener noreferrer"}},[t._v("building-oauth-apps"),n("OutboundLink")],1),t._v("，如下图所示：")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(253),alt:""}})]),t._v(" "),n("ul",[n("li",[t._v("查看 Client ID 及 Client Secret 并更新应用信息")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(254),alt:""}})])]),t._v(" "),n("li",[n("p",[t._v("新建 CI 项目，编写"),n("code",[t._v("docker-compose.yml")]),t._v("文件")]),t._v(" "),n("ul",[n("li",[t._v("新建 drone-ci 文件、docker-compose.yml 及 .env")])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 新建 drone-ci 文件夹")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" drone-ci\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 新建 docker-compose.yml")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" drone-ci/\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# .env 用于存储环境变量")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("touch")]),t._v(" .env\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker-compose.yml 会读取当前目录下的 .env 并注入环境变量")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("touch")]),t._v(" docker-compose.yml\n")])])]),n("ul",[n("li",[t._v("配置 .env 环境变量")])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 采用 key=value 格式")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# DRONE_HOST 为域名或 IP 地址")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 48.121.101.188 为示例 IP 地址")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("DRONE_HOST")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("48.121")]),t._v(".101.188\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# GITHUB_USERNAME 为 Github 用户名")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("GITHUB_USERNAME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("damo\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# GITHUB_CLIENT_ID 为 Github OAuth Apps Client ID")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("GITHUB_CLIENT_ID")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("55b4eab49d316cbd9eeb\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# GITHUB_CLIENT_SECRET 为 Github OAuth Apps Client Secret")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("GITHUB_CLIENT_SECRET")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("91f450234b96ba560b20522e2258415dc62b7f24\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# RPC_SECRET 为 drone-agent 与 drone-server 通信秘钥")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可通过 openssl rand -hex(base64) NUMBER 来生成")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 下面的 RPC_SECRET 即通过 openssl rand -hex 20 生成")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("RPC_SECRET")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("fe44fb33a1263d0ea437d666b6e53049725587ad\n")])])]),n("ul",[n("li",[t._v("配置 docker-compose.yml")])]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3.7"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nginx")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("alpine\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" drone_nginx\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"80:8090"')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" dronenet\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("drone-server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" drone/drone"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" dronetest_server\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" dronenet\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/drone/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("rw\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /var/run/docker.sock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/run/docker.sock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("rw\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DRONE_DEBUG=true\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DRONE_GITHUB_SERVER=https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//github.com\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DRONE_GITHUB_CLIENT_ID=$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("GITHUB_CLIENT_ID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DRONE_GITHUB_CLIENT_SECRET=$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("GITHUB_CLIENT_SECRET"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DRONE_RUNNER_CAPACITY=2\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DRONE_RPC_SECRET=$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("RPC_SECRET"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DRONE_SERVER_PROTO=http\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DRONE_SERVER_HOST=$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("DRONE_HOST"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DRONE_USER_CREATE=username"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("GITHUB_USERNAME"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("admin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("drone-agent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" drone/agent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" dronetest_agent\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" dronenet\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" drone"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /var/run/docker.sock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/run/docker.sock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("rw\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DRONE_RPC_SERVER=http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//drone_server\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DRONE_RPC_SECRET=$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("RPC_SECRET"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" DRONE_DEBUG=true\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dronenet")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n")])])])]),t._v(" "),n("li",[n("p",[t._v("运行容器，启动 Drone CI 服务")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 运行容器")]),t._v("\n$ docker-compose up -d\nCreating network "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"drone-ci_dronenet"')]),t._v(" with the default driver\nCreating drone_nginx      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\nCreating dronetest_server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\nCreating dronetest_agent  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看运行容器")]),t._v("\n$ docker-compose "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v("\n      Name               Command          State              Ports            \n  ------------------------------------------------------------------------------\n  drone_nginx        nginx -g daemon off"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   Up      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("/tcp, "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:80-"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8090")]),t._v("/tcp\n  dronetest_agent    /bin/drone-agent       Up                                  \n  dronetest_server   /bin/drone-server      Up      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("/tcp, "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("/tcp    \n\n")])])])]),t._v(" "),n("li",[n("p",[t._v("修改 nginx 配置文件")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进入 nginx 容器")]),t._v("\n$ docker-compose "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" nginx ash\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加 nginx 配置文件")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/nginx/conf.d/drone.conf\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  listen       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8090")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server_name  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("48.121")]),t._v(".101.188"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  location / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    proxy_pass http://dronetest_server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    proxy_set_header   Host             "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    proxy_set_header   X-Real-IP        "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    proxy_set_header   X-Forwarded-For  "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重启 nginx ")]),t._v("\n$ nginx -s reload\n")])])])]),t._v(" "),n("li",[n("p",[t._v("在浏览器访问 http://48.121.101.188，并进行仓库授权，即完成 Drone CI 的搭建")])])]),t._v(" "),n("h2",{attrs:{id:"配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置","aria-hidden":"true"}},[t._v("#")]),t._v(" 配置")]),t._v(" "),n("ol",[n("li",[t._v("浏览器访问 Drone CI 服务，点击"),n("code",[t._v("SYNC")]),t._v("按钮同步授权仓库信息")])]),t._v(" "),n("div",{staticClass:"tip custom-block"},[n("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),n("p",[t._v("除了本地部署服务以外，官方同时提供了 "),n("a",{attrs:{href:"https://cloud.drone.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Drone CI 云服务"),n("OutboundLink")],1)])]),t._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[n("p",[t._v("选择需要激活 Drone CI 服务的仓库，如下：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(255),alt:""}})]),t._v(" "),n("p",[t._v("到 Github 对应激活仓库下，查看 Webhook 是否激活")]),t._v(" "),n("p",[n("img",{attrs:{src:a(256),alt:""}})])]),t._v(" "),n("li",[n("p",[t._v("添加构建运行时的私密信息")]),t._v(" "),n("p",[n("img",{attrs:{src:a(257),alt:""}})]),t._v(" "),n("p",[t._v("USERNAME 为 Github 用户名，EMAIL 为 Github 注册邮件，GH_REF 为 Github 仓库，GH_TOKEN 为 Github Token")]),t._v(" "),n("p",[t._v("关于 Github Token 即 Github Personal Access Token，具体生成步骤可参阅： "),n("a",{attrs:{href:"https://help.github.com/en/articles/creating-a-personal-access-token-for-the-command-line#creating-a-token",target:"_blank",rel:"noopener noreferrer"}},[t._v("Github | creating-a-personal-access-token"),n("OutboundLink")],1)])]),t._v(" "),n("li",[n("p",[t._v("在当前项目根目录下配置 "),n("code",[t._v(".drone.yml")]),t._v(" 构建文件")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" pipeline\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" drone\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" install\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("commands")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" yarn install\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" build\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("commands")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" yarn build\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" deploy\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("commands")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" cd ./dist\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ls\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" git init\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" git config user.name $$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("USERNAME"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" git config user.email $$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("EMAIL"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" git add "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("A\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" git commit "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('m "'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("skip ci"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(' deploy"\n      '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" git push "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//$$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("GH_TOKEN"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("@$$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("GH_REF"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" master"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("gh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pages\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("USERNAME")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("from_secret")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" USERNAME\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("EMAIL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("from_secret")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" EMAIL\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("GH_REF")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("from_secret")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" GH_REF\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("GH_TOKEN")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("from_secret")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" GH_TOKE\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("trigger")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" master\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("event")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" push\n")])])]),n("p",[t._v("至此，Drone 已可以通过源代码 push 事件实现自动化部署静态博客。")])]),t._v(" "),n("li",[n("p",[t._v("配置 Slack 通知")]),t._v(" "),n("p",[t._v("因 Slack 网站 App Directory 页面，无官方的 Drone CI 应用提供，这里利用 Incoming WebHooks 应用来实现通知功能。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(258),alt:""}})]),t._v(" "),n("p",[t._v("添加 Incoming WebHooks 后获取 WebHook URL，如下图")]),t._v(" "),n("p",[n("img",{attrs:{src:a(259),alt:""}})]),t._v(" "),n("p",[t._v("返至 Drone CI 服务仓库私密信息配置，追加如下信息：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(260),alt:""}})]),t._v(" "),n("p",[t._v("当前项目根目录下 "),n("code",[t._v(".drone.yml")]),t._v(" 构建文件，新增如下高亮代码：")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" pipeline\n "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" drone\n\n "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" install\n     "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node\n     "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("commands")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" yarn install\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" build\n     "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node\n     "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("commands")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" yarn build\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" deploy\n     "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("commands")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" cd ./dist\n       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ls\n       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" git init\n       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" git config user.name $$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("USERNAME"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" git config user.email $$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("EMAIL"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" git add "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("A\n       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" git commit "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('m "'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("skip ci"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(' deploy"\n       '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" git push "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//$$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("GH_TOKEN"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("@$$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("GH_REF"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" master"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("gh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pages\n     "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("USERNAME")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n         "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("from_secret")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" USERNAME\n       "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("EMAIL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n         "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("from_secret")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" EMAIL\n       "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("GH_REF")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n         "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("from_secret")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" GH_REF\n       "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("GH_TOKEN")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n         "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("from_secret")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" GH_TOKE\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" slack\n     "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" plugins/slack\n     "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("settings")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("webhook")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n         "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("from_secret")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" SLACK_WEB_HOOK\n       "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("channel")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("notification\n       "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n         {{#success build.status}}\n         Repo `{{repo.name}}`build (<{{build.link}}|#{{build.number}}>) for commit(<{{build.link}}|{{truncate build.commit 7}}>) \n         on branch `{{build.branch}}` by `{{build.author}}`\n         Execution time: *{{since job.started}}*\n         Message: *The build {{build.status}}*\n         {{else}}\n           build {{build.number}} failed. Fix me please.\n         {{/success}} ")]),t._v("\n\n "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("trigger")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" master\n   "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("event")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" push\n")])])]),n("p",[t._v("至此构建完成时，便会发送构建相关信息通知到 Slack 对应的频道。")])])]),t._v(" "),n("h2",{attrs:{id:"参考链接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考链接","aria-hidden":"true"}},[t._v("#")]),t._v(" 参考链接")]),t._v(" "),n("ul",[n("li",[n("p",[n("a",{attrs:{href:"https://docs.drone.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Drone Docs"),n("OutboundLink")],1)])]),t._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://docs.drone.io/user-guide/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Drone | User Guide"),n("OutboundLink")],1)])]),t._v(" "),n("li",[n("p",[n("a",{attrs:{href:"http://plugins.drone.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Drone Plugins"),n("OutboundLink")],1)])]),t._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://docs.drone.io/reference/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Drone Reference"),n("OutboundLink")],1)])]),t._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://juejin.im/post/5c81f54c5188257e826a9dc7",target:"_blank",rel:"noopener noreferrer"}},[t._v("Drone CI For Github"),n("OutboundLink")],1)])]),t._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://dev.to/krusenas/setting-up-simple-self-hosted--fast-cicd-solution-with-drone-for-homelab-or-office-1fnd",target:"_blank",rel:"noopener noreferrer"}},[t._v("Setting up simple, self-hosted & fast CI/CD solution with Drone"),n("OutboundLink")],1)])]),t._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://angristan.xyz/host-your-own-ci-cd-server-with-drone/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Host your own CI/CD server with Drone"),n("OutboundLink")],1)])]),t._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://medium.com/@stepanvrany/drone-io-first-impressions-43d9338cd7e5",target:"_blank",rel:"noopener noreferrer"}},[t._v("Drone.io: first impressions"),n("OutboundLink")],1)])]),t._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://medium.com/asiayo-engineering/%E7%94%A8-drone-%E6%89%93%E9%80%A0-ci-cd-flow-36b9d14c7620",target:"_blank",rel:"noopener noreferrer"}},[t._v("用 Drone 打造 CI/CD flow"),n("OutboundLink")],1)])]),t._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://medium.com/pixelpoint/getting-started-with-open-source-drone-ci-1528de836cd1",target:"_blank",rel:"noopener noreferrer"}},[t._v("Getting started with open-source Drone CI"),n("OutboundLink")],1)])])])])},[],!1,null,null,null);s.default=e.exports}}]);